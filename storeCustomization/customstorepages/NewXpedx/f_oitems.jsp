<%@ page import="java.util.Date" %><%@ page import="com.cleanwise.view.utils.ClwCustomizer" %><%@ page import="com.cleanwise.view.utils.CleanwiseUser" %><%@ page import="com.cleanwise.view.utils.ShopTool" %><%@ page import="com.cleanwise.view.utils.Constants" %><%@ page import="com.cleanwise.service.api.util.RefCodeNames" %><%@ page import="com.cleanwise.view.i18n.ClwI18nUtil" %><%@ page import="com.cleanwise.service.api.value.ShoppingCartItemData" %><%@ page import="com.cleanwise.service.api.value.*" %><%@ taglib uri='/WEB-INF/struts-template.tld' prefix='template' %><%@ taglib uri="/WEB-INF/struts-bean.tld" prefix="bean" %><%@ taglib uri="/WEB-INF/application.tld" prefix="app" %><%@ taglib uri="/WEB-INF/struts-html.tld" prefix="html" %><%@ taglib uri="/WEB-INF/struts-logic.tld" prefix="logic" %><%@ taglib uri="/WEB-INF/i18n.tld" prefix="i18n" %><!--PAGESRCID=f_oitems.jsp --><style type="text/css">.shopcharthead {    color: #ffffff;    font-weight: bold;    background-color: #333333 ;}.shopcategory {    font-weight: bold;    color: #333333;    background-color: #DFDAFA ;}</style><%    int rowIdx = 0;        CleanwiseUser appUser = ShopTool.getCurrentUser(request);        String storeDir=ClwCustomizer.getStoreDir();    boolean inventoryShopping = ShopTool.isInventoryShoppingOn(request);        boolean modernInvShopping = ShopTool.isModernInventoryShopping(request);    Boolean filterVal=null;    String itemFilter = request.getParameter("itemFilter");    String keyName=  request.getParameter("keyName");    if(keyName==null)    {        keyName="shop.og.table.header.title.regular";    }    if (itemFilter != null && "regular".equals(itemFilter)) {        filterVal = Boolean.FALSE;    } else if (itemFilter != null && "inventory".equals(itemFilter)) {        filterVal = Boolean.TRUE;    }    int colIdx;    int TABIDX = 0;    String tabIdxS = request.getParameter("tabidx");        if(tabIdxS!=null && tabIdxS.trim().length()>0) {           TABIDX = Integer.parseInt(tabIdxS);        }    boolean firstrow = true;    String prevCategory = "";    String thisItemCategory = "";    String jspFormName = request.getParameter("jspFormName");        boolean  quickOrderView = false,  checkoutView = false,  editCartItems = true,  f_showSelectCol = false;String allowEdits = request.getParameter("allowEdits"), thisView = request.getParameter("view"), showSelectCol = request.getParameter("showSelectCol"), tmp_itemorder = request.getParameter("orderBy");if ( null == thisView ) thisView = "";if (      thisView.equals("quickOrder") ) { quickOrderView = true; }else if ( thisView.equals("checkout") )   { checkoutView = true; }if ( allowEdits != null && allowEdits.equals("false")) {  editCartItems = false;}if ( showSelectCol != null && showSelectCol.equals("true")) {  f_showSelectCol = true;  if ( appUser.canMakePurchases() == false )  {   f_showSelectCol = false;  }}int orderby = 0;if ( tmp_itemorder != null ) {  orderby = Integer.parseInt(tmp_itemorder);}%><app:defineProdColumnCount id="colCountInt" viewOptionEditCartItems="false" viewOptionQuickOrderView="<%=quickOrderView%>" viewOptionAddToCartList="false" viewOptionOrderGuide="true"/><%int colCount = ((Integer)pageContext.getAttribute("colCountInt")).intValue();%><bean:define id="IMGPath" type="java.lang.String" name="pages.store.images"/><bean:define id="theForm" name="<%=jspFormName%>"  type="com.cleanwise.view.forms.UserShopForm"/><logic:iterate id="item" name="SHOP_FORM" property="cartItems"               offset="0" indexId="kidx"               type="com.cleanwise.service.api.value.ShoppingCartItemData"><bean:define id="orderNumber" name="item" property="orderNumber"/><bean:define id="itemId" name="item" property="product.productId" type="java.lang.Integer" /><bean:define id="quantityEl" value="<%=\"quantityElement[\"+kidx+\"]\"%>"/><bean:define id="onhandEl" value="<%=\"onhandElement[\"+kidx+\"]\"%>"/><bean:define id="itemIdsEl" value="<%=\"itemIdsElement[\"+kidx+\"]\"%>"/><%boolean isUser=theForm.isUserOrderGuide(theForm.getOrderGuideId());SiteInventoryInfoView inventoryItemInfo = ShopTool.getInventoryItem(request, itemId.intValue()); %><%colIdx=0;%><% if(filterVal==null || ((ShoppingCartItemData)item).getIsaInventoryItem()==filterVal.booleanValue()) { %><%--<%if(firstrow) {%><tr><td class="shopcategory"></td><td class="shopchartheadTitle" colspan="<%=colCount-1%>"><app:storeMessage key="<%=keyName%>"/></td></tr><%}%>--%><% if (item.getIsaInventoryItem() == false) { %><% if(theForm.getOrderBy()==Constants.ORDER_BY_CATEGORY) { %><%    thisItemCategory = item.getCategoryPath();    if ( null == thisItemCategory ) {        thisItemCategory = "";    }%><% if (firstrow) { %><tr>    <td colspan="<%=colCount%>" class="shopcategory" width="<%=Constants.TABLEWIDTH%>" height="20px">        &nbsp;&nbsp;<bean:write name="item" property="categoryPath"/></td>    <% prevCategory = thisItemCategory; %></tr><%    firstrow = false;} else if(! prevCategory.equals(thisItemCategory)) { %><% prevCategory = thisItemCategory; %><tr>    <td colspan="<%=colCount%>" class="shopcategory" width="<%=Constants.TABLEWIDTH%>" height="20px">        &nbsp;&nbsp;<bean:write name="item" property="categoryPath"/></td></tr><% } %><% } %><% } else if (item.getIsaInventoryItem()) { %>        <% if(theForm.getOrderBy()==Constants.ORDER_BY_CATEGORY) {            thisItemCategory = item.getCategoryPath();            if ( null == thisItemCategory ) {                thisItemCategory = "";            }        %>        <% if (firstrow) { %>        <tr>            <td colspan="<%=colCount%>" class="shopcategory" width="<%=Constants.TABLEWIDTH%>" height="20px">                &nbsp;&nbsp;<bean:write name="item" property="categoryPath"/></td>            <% prevCategory = thisItemCategory; %>        </tr>        <%            firstrow = false;        } else if(! prevCategory.equals(thisItemCategory)) { %>        <% prevCategory = thisItemCategory;%>        <tr>            <td colspan="<%=colCount%>" class="shopcategory" width="<%=Constants.TABLEWIDTH%>" height="20px">                &nbsp;&nbsp;<bean:write name="item" property="categoryPath"/></td>        </tr>        <% } %>        <% } }%><%String styleClass = (((kidx) %2 )==0) ?  "evenRowColor" : "oddRowColor";%><tr class="<%=styleClass%>"><%String itemLink = "shop.do?action=msItem&source=t_itemDetail.jsp&itemId="+itemId+"&qty="+item.getQuantity();%>	<app:displayProd viewOptionEditCartItems="false" viewOptionQuickOrderView="<%=quickOrderView%>" viewOptionAddToCartList="false" viewOptionOrderGuide="true"	name="item" link="<%=itemLink%>" index="<%=kidx%>" inputNameOnHand="<%=\"cartLine[\" + kidx + \"].inventoryQtyOnHandString\"%>" inputNameQuantity="<%=\"cartLine[\" + kidx + \"].quantityString\"%>"/></tr><% if (inventoryShopping && item.getIsaInventoryItem() ) { if (item.getInventoryParValue() > 0) {     if (item.getInventoryQtyIsSet()) {        int newOnHandVal = 0;        try {            newOnHandVal = Integer.parseInt(item.getInventoryQtyOnHandString());        }catch (Exception e) {            newOnHandVal = 0;        }        item.setInventoryQtyOnHand(newOnHandVal);     }  }}%><%}  //filter values%> </logic:iterate>